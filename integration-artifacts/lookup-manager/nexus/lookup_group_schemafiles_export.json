{
  "group" : {
    "id" : 9,
    "name" : "SchemaFiles",
    "description" : "TechBD SchemaFiles",
    "version" : "1",
    "cacheSize" : 1000,
    "cachePolicy" : "LRU",
    "createdDate" : "2025-11-18T06:04:29.332+00:00",
    "updatedDate" : "2025-11-19T05:54:37.940+00:00"
  },
  "values" : {
    "hl7v2-fhir-bundle.xslt" : "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"1.0\"\n                xmlns:ccda=\"urn:hl7-org:v3\"\n                xmlns:fhir=\"http://hl7.org/fhir\"\n                xmlns:sdtc=\"urn:hl7-org:sdtc\"\n                exclude-result-prefixes=\"sdtc\">\n\n  <xsl:output method=\"text\"/>\n  \n  <xsl:param name=\"currentTimestamp\"/>\n  <xsl:param name=\"patientCIN\"/>\n  <xsl:param name=\"encounterType\"/>\n  <xsl:param name=\"organizationNPI\"/>\n  <xsl:param name=\"organizationTIN\"/>\n  <xsl:param name=\"facilityID\"/>\n  <xsl:param name=\"OrganizationName\"/>\n  <xsl:variable name=\"patientRoleId\" select=\"//ccda:patientRole/ccda:id[not(@assigningAuthorityName)]/@extension\"/>\n  <xsl:variable name=\"patientResourceName\" \n  select=\"normalize-space(concat(\n\t\t  //PID/PID.5/PID.5.1, &quot; &quot;, \n\t\t  //PID/PID.5/PID.5.2, &quot; &quot;, \n\t\t  //PID/PID.5/PID.5.3, &quot;  &quot;, \n\t\t  //PID/PID.9/PID.9.1, &quot; &quot;, \n\t\t  //PID/PID.9/PID.9.2, &quot; &quot;, \n\t\t  //PID/PID.9/PID.9.3\n\t\t))\"/>\n  <xsl:variable name=\"bundleTimestamp\" select=\"MSH/MSH.7/MSH.7.1\"/>\n\n  <xsl:param name=\"bundleId\"/>\n  <xsl:param name=\"patientResourceId\"/>\n  <xsl:param name=\"encounterResourceId\"/>\n  <xsl:param name=\"consentResourceId\"/>\n  <xsl:param name=\"organizationResourceId\"/>\n  <xsl:param name=\"questionnaireResourceId\"/>\n  <xsl:param name=\"observationResourceSha256Id\"/>\n  <xsl:param name=\"sexualOrientationResourceId\"/>\n  <xsl:param name=\"questionnaireResponseResourceSha256Id\"/>\n  <xsl:param name=\"procedureResourceSha256Id\"/>\n  <xsl:param name=\"grouperObservationResourceSha256Id\"/>\n  <xsl:param name=\"categoryXml\"/>\n  <xsl:param name=\"componentAnswersXml\"/>  \n\n  <!-- Parameters to get FHIR resource profile URLs -->\n  <xsl:param name=\"baseFhirUrl\"/>\n  <xsl:param name=\"bundleMetaProfileUrl\"/>\n  <xsl:param name=\"patientMetaProfileUrl\"/>\n  <xsl:param name=\"consentMetaProfileUrl\"/>\n  <xsl:param name=\"encounterMetaProfileUrl\"/>\n  <xsl:param name=\"organizationMetaProfileUrl\"/>\n  <xsl:param name=\"observationMetaProfileUrl\"/>\n  <xsl:param name=\"observationSexualOrientationMetaProfileUrl\"/>\n  <xsl:param name=\"questionnaireMetaProfileUrl\"/>\n  <xsl:param name=\"questionnaireResponseMetaProfileUrl\"/>\n  <xsl:param name=\"practitionerMetaProfileUrl\"/>\n  <xsl:param name=\"procedureMetaProfileUrl\"/>\n\n  <xsl:variable name=\"bundleMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $bundleMetaProfileUrl)\"/>\n  <xsl:variable name=\"patientMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $patientMetaProfileUrl)\"/>\n  <xsl:variable name=\"consentMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $consentMetaProfileUrl)\"/>\n  <xsl:variable name=\"encounterMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $encounterMetaProfileUrl)\"/>\n  <xsl:variable name=\"organizationMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $organizationMetaProfileUrl)\"/>\n  <xsl:variable name=\"observationMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $observationMetaProfileUrl)\"/>\n  <xsl:variable name=\"observationSexualOrientationMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $observationSexualOrientationMetaProfileUrl)\"/>\n  <xsl:variable name=\"questionnaireMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $questionnaireMetaProfileUrl)\"/>\n  <xsl:variable name=\"questionnaireResponseMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $questionnaireResponseMetaProfileUrl)\"/>\n  <xsl:variable name=\"practitionerMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $practitionerMetaProfileUrl)\"/>\n  <xsl:variable name=\"procedureMetaProfileUrlFull\" select=\"concat($baseFhirUrl, $procedureMetaProfileUrl)\"/>\n\n <xsl:template match=\"/\">\n{\n  \"resourceType\": \"Bundle\",\n  \"id\": \"<xsl:value-of select='$bundleId'/>\",\n  \"meta\": {\n    \"lastUpdated\": \"<xsl:value-of select='$currentTimestamp'/>\",\n    \"profile\": [\n      \"<xsl:value-of select='$bundleMetaProfileUrlFull'/>\"\n    ]\n  },\n  \"type\": \"transaction\"\n  <xsl:if test=\"$bundleTimestamp\">\n    , \"timestamp\": \"<xsl:call-template name='formatDateTime'>\n                        <xsl:with-param name='dateTime' select='$bundleTimestamp'/>\n                    </xsl:call-template>\"\n  </xsl:if>,\n  \"entry\": [\n\t  <xsl:variable name=\"consent\"><xsl:call-template name=\"ConsentFromOBX\"/></xsl:variable>\n\t  <xsl:if test=\"normalize-space($consent)\">\n\t\t<xsl:value-of select=\"$consent\"/>\n\t\t<xsl:text>,</xsl:text>\n\t  </xsl:if>\n\n\t  <xsl:variable name=\"encounter\"><xsl:call-template name=\"EncounterFromPV\"/></xsl:variable>\n\t  <xsl:if test=\"normalize-space($encounter)\">\n\t\t<xsl:value-of select=\"$encounter\"/>\n\t\t<xsl:text>,</xsl:text>\n\t  </xsl:if>\n\n\t  <xsl:variable name=\"org\"><xsl:call-template name=\"OrganizationFromXON\"/></xsl:variable>\n\t  <xsl:if test=\"normalize-space($org)\">\n\t\t<xsl:value-of select=\"$org\"/>\n\t\t<xsl:text>,</xsl:text>\n\t  </xsl:if>\n\t  \n\t  <xsl:variable name=\"pid\"><xsl:call-template name=\"PatientFromPID\"/></xsl:variable>\n\t  <xsl:if test=\"normalize-space($pid)\">\n\t\t<xsl:value-of select=\"$pid\"/>\n\t\t<xsl:text>,</xsl:text>\n\t  </xsl:if>\n\n\t  <xsl:variable name=\"sog\"><xsl:call-template name=\"SexualOrientationFromOBX\"/></xsl:variable>\n\t  <xsl:if test=\"normalize-space($sog)\">\n\t\t<xsl:value-of select=\"$sog\"/>\n\t\t<xsl:text>,</xsl:text>\n\t  </xsl:if>\n\n\t  <!-- Observation entries -->\n\t  <xsl:for-each select=\"//OBX[string(OBX.5/OBX.5.1) and OBX.5/OBX.5.1 != 'UNK' and string(OBX.3/OBX.3.1) and OBX.3/OBX.3.1 != 'UNK' and OBX.3/OBX.3.1 != '76690-7']\">\n\t  <xsl:variable name=\"obs\">\n\t\t<xsl:call-template name=\"ObservationFromXON\"/>\n\t  </xsl:variable>\n\t  <xsl:if test=\"normalize-space($obs)\">\n\t\t<xsl:if test=\"position() != 1 and position() != last()\">,</xsl:if>\n\t\t<xsl:value-of select=\"$obs\"/>\n\t  </xsl:if>\n\t</xsl:for-each>\n\t\n\t<xsl:call-template name=\"GrouperObservationFromOBR\"/>\n\t]\n\n}\n</xsl:template>\n\n<!-- Patient Template -->\n  <xsl:template name=\"PatientFromPID\">\n    {\n      \"fullUrl\": \"<xsl:value-of select='$baseFhirUrl'/>/Patient/<xsl:value-of select='$patientResourceId'/>\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"id\": \"<xsl:value-of select='$patientResourceId'/>\",\n        \"meta\": {\n          \"lastUpdated\": \"<xsl:value-of select='$currentTimestamp'/>\",\n          \"profile\": [\"<xsl:value-of select='$patientMetaProfileUrlFull'/>\"]\n        }\n        <!-- <xsl:if test=\"//PID/PID.15\"> -->\n\t\t  <!-- ,\"language\":  -->\n\t\t\t\t<!-- \"<xsl:choose> -->\n\t\t\t\t\t<!-- <xsl:when test='//PID/PID.15/PID.15.1 = &quot;001&quot; or not(string(//PID/PID.15/PID.15.1))'>en</xsl:when> -->\n\t\t\t\t\t<!-- <xsl:otherwise><xsl:value-of select='PID/PID.15/PID.15.1'/></xsl:otherwise> -->\n\t\t\t\t<!-- </xsl:choose>\" -->\n\n\t\t<!-- </xsl:if> -->\n\n        <!--If there is Official Name, print it, otherwise print first occuring name-->\n        <xsl:if test=\"//PID/PID.5/PID.5.1\">\n            , \"name\": [\n                <xsl:call-template name=\"generateNameJson\">\n\t\t\t\t  <xsl:with-param name=\"nameNode\" select=\"//PID.5\"/>\n\t\t\t\t</xsl:call-template>\n            ]\n        </xsl:if>\n        <xsl:if test=\"not(//PID/PID.5/PID.5.1) and //PID/PID.9/PID.9.1\">\n            , \"name\": [\n                <xsl:call-template name=\"generateNameJson\">\n\t\t\t\t\t<xsl:with-param name=\"nameNode\" select=\"//PID.9\"/>\n\t\t\t\t  </xsl:call-template>\n            ]\n        </xsl:if>\n\n        , \"gender\": \"<xsl:choose>\n\t\t\t<xsl:when test='//PID.8 = \"\" or //PID.8 = \"U\"'>\n\t\t\t\t<xsl:call-template name=\"getNullFlavorDisplay\">\n\t\t\t\t\t<xsl:with-param name=\"nullFlavor\" select=\"'UNK'\"/>\n\t\t\t\t</xsl:call-template>\n\t\t\t</xsl:when>\n\t\t\t<xsl:when test='//PID.8 = \"M\"'>male</xsl:when>\n\t\t\t<xsl:when test='//PID.8 = \"F\"'>female</xsl:when>\n\t\t\t<xsl:when test='//PID.8 = \"O\"'>other</xsl:when>\n\t\t\t<xsl:otherwise><xsl:value-of select='//PID.8'/></xsl:otherwise>\n\t\t</xsl:choose>\"\n\n        <xsl:if test=\"string(//PID.7/PID.7.1)\">\n\t\t  , \"birthDate\": \"<xsl:choose>\n\t\t\t\t\t\t   <xsl:when test=\"string-length(//PID.7/PID.7.1) >= 8\">\n\t\t\t\t\t\t\t <xsl:value-of select=\"concat(substring(//PID.7/PID.7.1, 1, 4), '-', substring(//PID.7/PID.7.1, 5, 2), '-', substring(//PID.7/PID.7.1, 7, 2))\"/>\n\t\t\t\t\t\t   </xsl:when>\n\t\t\t\t\t\t   <xsl:otherwise>\n\t\t\t\t\t\t\t <xsl:value-of select=\"//PID.7/PID.7.1\"/>\n\t\t\t\t\t\t   </xsl:otherwise>\n\t\t\t\t\t\t </xsl:choose>\"\n\t\t</xsl:if>\n        <xsl:if test=\"//PID.11[PID.11.1 or PID.11.3 or PID.11.4 or PID.11.5]\">\n\t\t\t  , \"address\": [\n\t\t\t\t<xsl:for-each select=\"//PID.11[PID.11.1 or PID.11.3 or PID.11.4 or PID.11.5]\">\n\t\t\t\t  {\n\t\t\t\t\t\t<!-- text -->\n\t\t\t\t\t\t<xsl:if test=\"PID.11.1 or PID.11.2 or PID.11.3 or PID.11.4 or PID.11.5 or PID.11.6\">\n\t\t\t\t\t\t  \"text\": \"<xsl:value-of select=\"normalize-space(concat(PID.11.1, ' ', PID.11.2, ' ', PID.11.3, ' ', PID.11.4, ' ', PID.11.5, ' ', PID.11.6))\"/>\",\n\t\t\t\t\t\t</xsl:if>\n                        <!-- line -->\n\t\t\t\t\t\t<xsl:if test=\"PID.11.1 or PID.11.2\">\n\t\t\t\t\t\t  \"line\": [\n\t\t\t\t\t\t\t\"<xsl:value-of select=\"normalize-space(concat(PID.11.1, ' ', PID.11.2))\"/>\"\n\t\t\t\t\t\t  ],\n\t\t\t\t\t\t</xsl:if>\n                        <!-- city -->\n\t\t\t\t\t\t<xsl:if test=\"PID.11.3\">\n\t\t\t\t\t\t  \"city\": \"<xsl:value-of select=\"PID.11.3\"/>\",\n\t\t\t\t\t\t</xsl:if>\n                        <!-- district -->\n\t\t\t\t\t\t<xsl:if test=\"PID.11.9\">\n\t\t\t\t\t\t  \"district\": \"<xsl:value-of select=\"PID.11.9\"/>\",\n\t\t\t\t\t\t</xsl:if>\n                        <!-- state -->\n\t\t\t\t\t\t<xsl:if test=\"PID.11.4\">\n\t\t\t\t\t\t  \"state\": \"<xsl:value-of select=\"PID.11.4\"/>\",\n\t\t\t\t\t\t</xsl:if>\n                        <!-- postalCode -->\n\t\t\t\t\t\t<xsl:if test=\"PID.11.5\">\n\t\t\t\t\t\t  \"postalCode\": \"<xsl:value-of select=\"PID.11.5\"/>\"\n\t\t\t\t\t\t</xsl:if>\n                    } <xsl:if test=\"position() != last()\">,</xsl:if>\n                </xsl:for-each>\n            ]\n        </xsl:if>\n\n\t\t<xsl:if test=\"//PID.13[normalize-space(PID.13.1)] or //PID.14[normalize-space(PID.14.1)] or //PID.40[normalize-space(PID.40.1)]\">\n\t\t  , \"telecom\": [\n\t\t\t<xsl:for-each select=\"//PID.13[normalize-space(PID.13.1)] | //PID.14[normalize-space(PID.14.1)] | //PID.40[normalize-space(PID.40.1)]\">\n\t\t\t  {\n\t\t\t\t<!-- system -->\n\t\t\t\t<xsl:if test=\"*[3]\">\n\t\t\t\t  \"system\": \"<xsl:choose>\n\t\t\t\t\t\t\t  <xsl:when test=\"*[3]='PH' or *[3]='TEL'\">phone</xsl:when>\n\t\t\t\t\t\t\t  <xsl:when test=\"*[3]='EM' or *[3]='MAIL'\">email</xsl:when>\n\t\t\t\t\t\t\t  <xsl:otherwise>other</xsl:otherwise>\n\t\t\t\t\t\t\t</xsl:choose>\",\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<!-- use -->\n\t\t\t\t<xsl:if test=\"*[2]\">\n\t\t\t\t  \"use\": \"<xsl:choose>\n\t\t\t\t\t\t   <xsl:when test=\"*[2]='WPN' or *[2]='WP'\">work</xsl:when>\n\t\t\t\t\t\t   <xsl:when test=\"*[2]='PRN' or *[2]='H'\">home</xsl:when>\n\t\t\t\t\t\t   <xsl:when test=\"*[2]='NET' or *[2]='MC'\">mobile</xsl:when>\n\t\t\t\t\t\t   <xsl:when test=\"*[2]='TMP'\">temp</xsl:when>\n\t\t\t\t\t\t   <xsl:when test=\"*[2]='BAD'\">old</xsl:when>\n\t\t\t\t\t\t   <xsl:otherwise><xsl:value-of select=\"*[2]\"/></xsl:otherwise>\n\t\t\t\t\t\t </xsl:choose>\",\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<!-- value -->\n\t\t\t\t\"value\": \"<xsl:value-of select=\"*[1]\"/>\"\n\t\t\t  }<xsl:if test=\"position() != last()\">,</xsl:if>\n\t\t\t</xsl:for-each>\n\t\t  ]\n\t\t</xsl:if>\n        \n\t  <xsl:if test=\"//PID.10 or //PID.22 or //PID.8.1\">\n\t\t  , \"extension\": [\n\t\t\t<xsl:variable name=\"ombRaceCodes\" select=\"'1002-5 2028-9 2054-5 2076-8 2106-3 UNK ASKU'\" />\n\t\t\t<xsl:variable name=\"ombEthnicityCodes\" select=\"'2135-2 2186-5 UNK ASKU'\" />\n\n\t\t\t<!-- RACE extension -->\n\t\t\t<xsl:if test=\"//PID.10.1\">\n\t\t\t  {\n\t\t\t\t\"extension\": [\n\t\t\t\t  <xsl:for-each select=\"//PID.10\">\n\t\t\t\t\t<xsl:if test=\"position() > 1\"><xsl:text>,</xsl:text></xsl:if>\n\t\t\t\t\t{\n\t\t\t\t\t  \"url\": \"<xsl:choose>\n\t\t\t\t\t\t\t\t<xsl:when test=\"contains($ombRaceCodes, PID.10.1)\">ombCategory</xsl:when>\n\t\t\t\t\t\t\t\t<xsl:otherwise>detailed</xsl:otherwise>\n\t\t\t\t\t\t\t </xsl:choose>\",\n\t\t\t\t\t  \"valueCoding\": {\n\t\t\t\t\t\t\"system\": \"<xsl:choose>\n\t\t\t\t\t\t\t\t\t <xsl:when test='PID.10.1 = \"UNK\" or PID.10.1 = \"ASKU\"'>http://terminology.hl7.org/CodeSystem/v3-NullFlavor</xsl:when>\n\t\t\t\t\t\t\t\t\t <xsl:otherwise>urn:oid:<xsl:value-of select='PID.10.3'/></xsl:otherwise>\n\t\t\t\t\t\t\t   </xsl:choose>\",\t\t\t\t\t\t\n\t\t\t\t\t\t\"code\": \"<xsl:value-of select='PID.10.1'/>\",\n\t\t\t\t\t\t\"display\": \"<xsl:value-of select='PID.10.2'/>\"\n\t\t\t\t\t  }\n\t\t\t\t\t}\n\t\t\t\t  </xsl:for-each>\n\t\t\t\t  <xsl:if test=\"//PID.10\"><xsl:text>,</xsl:text></xsl:if>\n\t\t\t\t  {\n\t\t\t\t\t\"url\": \"text\",\n\t\t\t\t\t\"valueString\": \"<xsl:for-each select='//PID.10'>\n\t\t\t\t\t\t\t\t\t  <xsl:value-of select='PID.10.2'/>\n\t\t\t\t\t\t\t\t\t  <xsl:if test='position() != last()'>\n\t\t\t\t\t\t\t\t\t\t<xsl:text>, </xsl:text>\n\t\t\t\t\t\t\t\t\t  </xsl:if>\n\t\t\t\t\t\t\t\t\t</xsl:for-each>\"\n\t\t\t\t  }\n\t\t\t\t],\n\t\t\t\t\"url\": \"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race\"\n\t\t\t  }\n\t\t\t  <xsl:if test=\"//PID.22.1 or //PID.8.1\"><xsl:text>,</xsl:text></xsl:if>\n\t\t\t</xsl:if>\n\n\t\t\t<!-- ETHNICITY extension -->\n\t\t\t<xsl:if test=\"//PID.22.1\">\n\t\t\t  {\n\t\t\t\t\"extension\": [\n\t\t\t\t  <xsl:for-each select=\"//PID.22\">\n\t\t\t\t\t<xsl:if test=\"position() > 1\"><xsl:text>,</xsl:text></xsl:if>\n\t\t\t\t\t{\n\t\t\t\t\t  \"url\": \"<xsl:choose>\n\t\t\t\t\t\t\t\t<xsl:when test=\"contains($ombEthnicityCodes, PID.22.1)\">ombCategory</xsl:when>\n\t\t\t\t\t\t\t\t<xsl:otherwise>detailed</xsl:otherwise>\n\t\t\t\t\t\t\t </xsl:choose>\",\n\t\t\t\t\t  \"valueCoding\": {\n\t\t\t\t\t\t\"system\": \"urn:oid:<xsl:value-of select='PID.22.3'/>\",\n\t\t\t\t\t\t\"code\": \"<xsl:value-of select='PID.22.1'/>\",\n\t\t\t\t\t\t\"display\": \"<xsl:value-of select='PID.22.2'/>\"\n\t\t\t\t\t  }\n\t\t\t\t\t}\n\t\t\t\t  </xsl:for-each>\n\t\t\t\t  <xsl:if test=\"//PID.22.1\"><xsl:text>,</xsl:text></xsl:if>\n\t\t\t\t  {\n\t\t\t\t\t\"url\": \"text\",\n\t\t\t\t\t\"valueString\": \"<xsl:for-each select='//PID.22'>\n\t\t\t\t\t\t\t\t\t  <xsl:value-of select='PID.22.2'/>\n\t\t\t\t\t\t\t\t\t  <xsl:if test='position() != last()'>\n\t\t\t\t\t\t\t\t\t\t<xsl:text>, </xsl:text>\n\t\t\t\t\t\t\t\t\t  </xsl:if>\n\t\t\t\t\t\t\t\t\t</xsl:for-each>\"\n\t\t\t\t  }\n\t\t\t\t],\n\t\t\t\t\"url\": \"http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity\"\n\t\t\t  }\n\t\t\t  <xsl:if test=\"//PID.8.1\"><xsl:text>,</xsl:text></xsl:if>\n\t\t\t</xsl:if>\n\n\t\t\t<!-- Administrative Gender -->\n\t\t\t<xsl:if test=\"string(//PID.8.1)\">\n\t\t\t  {\n\t\t\t\t\"url\": \"http://terminology.hl7.org/CodeSystem/v3-AdministrativeGender\",\n\t\t\t\t\"valueCode\": \"<xsl:call-template name='mapAdministrativeGenderCode'>\n\t\t\t\t\t\t\t\t<xsl:with-param name='genderCode' select='//PID.8.1'/>\n\t\t\t\t\t\t\t  </xsl:call-template>\"\n\t\t\t  }\n\t\t\t</xsl:if>\n\t\t  ]\n\t\t</xsl:if>\n\n      <xsl:variable name=\"cinId\" select=\"$patientCIN\"/>\n\n\t\t<xsl:variable name=\"ssnId\" select=\"//PID.19/PID.19.1\"/>\n\t\t\n\t\t<xsl:variable name=\"mrnId\" select=\"//PID.3/PID.3.1\"/>\n\n      <xsl:if test=\"$cinId or $ssnId or $mrnId\">\n      , \"identifier\": [\n        <!-- CIN (EPI) -->\n        <xsl:if test=\"$cinId\">\n          {\n            \"type\": {\n              \"coding\": [{\n                \"system\": \"http://terminology.hl7.org/CodeSystem/v2-0203\",\n                \"code\": \"MA\",\n                \"display\": \"Patient Medicaid Number\"\n              }],\n              \"text\": \"Patient Medicaid Number\"\n            },\n            \"system\": \"http://www.medicaid.gov/\",\n            \"value\": \"<xsl:value-of select=\"$cinId\"/>\"\n          }<xsl:if test=\"$ssnId or $mrnId\">,</xsl:if>\n        </xsl:if>\n\n        <!-- SSN (JMR123) -->\n        <xsl:if test=\"$ssnId\">\n          {\n            \"type\": {\n              \"coding\": [{\n                \"system\": \"http://terminology.hl7.org/CodeSystem/v2-0203\",\n                \"code\": \"SS\",\n                \"display\": \"Social Security Number\"\n              }],\n              \"text\": \"Social Security Number\"\n            },\n            \"system\": \"http://www.ssa.gov/\",\n            \"value\": \"<xsl:value-of select=\"$ssnId\"/>\"\n          }<xsl:if test=\"$mrnId\">,</xsl:if>\n        </xsl:if>\n\n        <!-- MR (no assigningAuthorityName) -->\n        <xsl:if test=\"$mrnId\">\n          {\n            \"type\": {\n              \"coding\": [{\n                \"system\": \"http://terminology.hl7.org/CodeSystem/v2-0203\",\n                \"code\": \"MR\",\n                \"display\": \"Medical Record Number\"\n              }],\n              \"text\": \"Medical Record Number\"\n            },\n            \"system\": \"http://www.scn.gov/facility/<xsl:value-of select=\"$facilityID\"/>\",\n            \"value\": \"<xsl:value-of select=\"$mrnId\"/>\"\n            <xsl:if test=\"string($organizationResourceId)\">\n              , \"assigner\": {\n                \"reference\": \"Organization/<xsl:value-of select=\"$organizationResourceId\"/>\"\n              }\n            </xsl:if>\n          }\n        </xsl:if>\n      ]\n      </xsl:if>\n\n      <xsl:if test=\"string(//PID.30/PID.30.1)\">\n\t\t  , \"deceasedBoolean\": <xsl:choose>\n\t\t\t  <xsl:when test=\"normalize-space(//PID.30/PID.30.1) = 'Y'\">true</xsl:when>\n\t\t\t  <xsl:otherwise>false</xsl:otherwise>\n\t\t\t</xsl:choose>\n\t\t</xsl:if>\n\n      \n      <xsl:variable name=\"mappedCode\">\n\t\t  <xsl:call-template name=\"mapMaritalStatusCode\">\n\t\t\t<xsl:with-param name=\"statusCode\" select=\"//PID.16/PID.16.1\"/>\n\t\t  </xsl:call-template>\n\t\t</xsl:variable>\n\n\t\t<!-- Output maritalStatus only if mappedCode is non-empty -->\n\t\t<xsl:if test=\"string($mappedCode)\">\n\t\t  , \"maritalStatus\": {\n\t\t\t\"coding\": [{\n\t\t\t  \"system\": \"http://terminology.hl7.org/CodeSystem/v3-MaritalStatus\",\n\t\t\t  \"code\": \"<xsl:value-of select='$mappedCode'/>\",\n\t\t\t  \"display\": \"<xsl:call-template name='mapMaritalStatus'>\n\t\t\t\t\t\t\t<xsl:with-param name='statusCode' select='//PID.16/PID.16.1'/>\n\t\t\t\t\t\t  </xsl:call-template>\"\n\t\t\t}]\n\t\t  }\n\t\t</xsl:if>\n\t\t\n\t\t<xsl:if test=\"//NK1\">\n\t\t  , \"contact\": [\n\t\t\t<xsl:for-each select=\"//NK1\">\n\t\t\t  {\n\t\t\t\t<!-- Relationship: NK1.7 -->\n\t\t\t\t<xsl:choose>\n\t\t\t\t  <xsl:when test=\"string(NK1.7/NK1.7.1)\">\n\t\t\t\t\t\"relationship\": [{\n\t\t\t\t\t  \"coding\": [{\n\t\t\t\t\t\t\"system\": \"http://terminology.hl7.org/CodeSystem/v2-0063\",\n\t\t\t\t\t\t\"code\": \"<xsl:value-of select='NK1.7/NK1.7.1'/>\",\n\t\t\t\t\t\t\"display\": \"<xsl:value-of select='NK1.7/NK1.7.2'/>\"\n\t\t\t\t\t  }]\n\t\t\t\t\t}],\n\t\t\t\t  </xsl:when>\n\t\t\t\t  <xsl:when test=\"string(NK1.3/NK1.3.1)\">\n\t\t\t\t\t\"relationship\": [{\n\t\t\t\t\t  \"coding\": [{\n\t\t\t\t\t\t\"system\": \"http://terminology.hl7.org/CodeSystem/v2-0063\",\n\t\t\t\t\t\t\"code\": \"<xsl:value-of select='NK1.3/NK1.3.1'/>\",\n\t\t\t\t\t\t\"display\": \"<xsl:value-of select='NK1.3/NK1.3.2'/>\"\n\t\t\t\t\t  }]\n\t\t\t\t\t}],\n\t\t\t\t  </xsl:when>\n\t\t\t\t</xsl:choose>\n\n\t\t\t\t<!-- Name: NK1.2 -->\n\t\t\t\t<xsl:if test=\"string(NK1.2/NK1.2.1) or string(NK1.2/NK1.2.2)\">\n\t\t\t\t  \"name\": {\n\t\t\t\t\t<xsl:if test=\"string(NK1.2/NK1.2.1)\">\n\t\t\t\t\t  \"family\": \"<xsl:value-of select='NK1.2/NK1.2.1'/>\"<xsl:if test=\"string(NK1.2/NK1.2.2)\">,</xsl:if>\n\t\t\t\t\t</xsl:if>\n\t\t\t\t\t<xsl:if test=\"string(NK1.2/NK1.2.2)\">\n\t\t\t\t\t  \"given\": [\"<xsl:value-of select='NK1.2/NK1.2.2'/>\"]\n\t\t\t\t\t</xsl:if>\n\t\t\t\t  },\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<!-- Telecom: NK1.5 (phone), NK1.6 (business phone), NK1.40 (mobile) -->\n\t\t\t\t<xsl:if test=\"string(NK1.5) or string(NK1.6) or string(NK1.40)\">\n\t\t\t\t  \"telecom\": [\n\t\t\t\t\t<xsl:if test=\"string(NK1.5)\">\n\t\t\t\t\t  { \"system\": \"phone\", \"value\": \"<xsl:value-of select='NK1.5'/>\" }<xsl:if test=\"string(NK1.6) or string(NK1.40)\">,</xsl:if>\n\t\t\t\t\t</xsl:if>\n\t\t\t\t\t<xsl:if test=\"string(NK1.6)\">\n\t\t\t\t\t  { \"system\": \"phone\", \"value\": \"<xsl:value-of select='NK1.6'/>\" }<xsl:if test=\"string(NK1.40)\">,</xsl:if>\n\t\t\t\t\t</xsl:if>\n\t\t\t\t\t<xsl:if test=\"string(NK1.40)\">\n\t\t\t\t\t  { \"system\": \"phone\", \"value\": \"<xsl:value-of select='NK1.40'/>\" }\n\t\t\t\t\t</xsl:if>\n\t\t\t\t  ],\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<!-- Address: NK1.4 -->\n\t\t\t\t<xsl:if test=\"NK1.4\">\n\t\t\t\t  \"address\": {\n\t\t\t\t\t<xsl:if test=\"string(NK1.4/NK1.4.1)\">\n\t\t\t\t\t  \"line\": [\"<xsl:value-of select='NK1.4/NK1.4.1'/>\"]\n\t\t\t\t\t</xsl:if>\n\t\t\t\t\t<xsl:if test=\"string(NK1.4/NK1.4.3)\">\n\t\t\t\t\t  , \"city\": \"<xsl:value-of select='NK1.4/NK1.4.3'/>\"\n\t\t\t\t\t</xsl:if>\n\t\t\t\t\t<xsl:if test=\"string(NK1.4/NK1.4.4)\">\n\t\t\t\t\t  , \"state\": \"<xsl:value-of select='NK1.4/NK1.4.4'/>\"\n\t\t\t\t\t</xsl:if>\n\t\t\t\t\t<xsl:if test=\"string(NK1.4/NK1.4.5)\">\n\t\t\t\t\t  , \"postalCode\": \"<xsl:value-of select='NK1.4/NK1.4.5'/>\"\n\t\t\t\t\t</xsl:if>\n\t\t\t\t  }\n\t\t\t\t</xsl:if>\n\t\t\t  }<xsl:if test=\"position() != last()\">,</xsl:if>\n\t\t\t</xsl:for-each>\n\t\t  ]\n\t\t</xsl:if>\n      \n      <!-- <xsl:if test=\"//PID/PID.15\"> -->\n\t\t  <!-- ,\"communication\": [ -->\n\t\t\t<!-- { -->\n\t\t\t  <!-- \"language\": { -->\n\t\t\t\t<!-- \"coding\": [ -->\n\t\t\t\t  <!-- { -->\n\t\t\t\t\t<!-- \"system\": \"urn:ietf:bcp:47\", -->\n\t\t\t\t\t<!-- \"code\": \"<xsl:choose> -->\n\t\t\t\t\t\t\t   <!-- <xsl:when test='//PID/PID.15/PID.15.1 = &quot;001&quot; or not(string(//PID/PID.15/PID.15.1))'>en</xsl:when> -->\n\t\t\t\t\t\t\t   <!-- <xsl:otherwise><xsl:value-of select='PID/PID.15/PID.15.1'/></xsl:otherwise> -->\n\t\t\t\t\t\t\t <!-- </xsl:choose>\" -->\n\t\t\t\t  <!-- } -->\n\t\t\t\t<!-- ] -->\n\t\t\t  <!-- }, -->\n\t\t\t  <!-- \"preferred\": true -->\n\t\t\t<!-- } -->\n\t\t  <!-- ] -->\n\t\t<!-- </xsl:if>     -->\n    }\n    , \"request\" : {\n        \"method\" : \"POST\",\n        \"url\" : \"<xsl:value-of select='$baseFhirUrl'/>/Patient/<xsl:value-of select='$patientResourceId'/>\"\n      }\n  }\n  </xsl:template>\n\n<!-- Sexual orientation Observation Template -->\n  <xsl:template name=\"SexualOrientationFromOBX\">\n  <xsl:for-each select=\"//OBX[OBX.3/OBX.3.1 = '76690-7' and string-length(OBX.5/OBX.5.1) > 0]\">\n    <xsl:if test=\"position() != 1\">\n      <xsl:text>,</xsl:text>\n    </xsl:if>\n      {\n        \"fullUrl\" : \"<xsl:value-of select='$baseFhirUrl'/>/Observation/<xsl:value-of select='$sexualOrientationResourceId'/>\",\n        \"resource\": {\n          \"resourceType\": \"Observation\",\n          \"id\": \"<xsl:value-of select='$sexualOrientationResourceId'/>\",\n          \"meta\": {\n            \"lastUpdated\": \"<xsl:value-of select='$currentTimestamp'/>\",\n            \"profile\": [\"<xsl:value-of select='$observationSexualOrientationMetaProfileUrlFull'/>\"]\n          },\n          \"status\": \"<xsl:call-template name='mapObservationStatus'>\n                       <xsl:with-param name='statusCode' select='OBX.11'/>\n                     </xsl:call-template>\",\n          \"code\": {\n            \"coding\": [{\n              \"system\": \"http://loinc.org\",\n              \"code\": \"<xsl:value-of select='OBX.3/OBX.3.1'/>\",\n              \"display\": \"<xsl:value-of select='OBX.3/OBX.3.2'/>\"\n            }],\n            \"text\": \"<xsl:choose>\n                       <xsl:when test='string(OBX.3/OBX.3.9)'>\n                         <xsl:value-of select='OBX.3/OBX.3.9'/>\n                       </xsl:when>\n                       <xsl:otherwise>\n                         <xsl:value-of select='OBX.3/OBX.3.2'/>\n                       </xsl:otherwise>\n                     </xsl:choose>\"\n          },\n\n          <xsl:choose>\n\n\t\t\t<!-- If value is unknown or empty -->\n\t\t\t<xsl:when test=\"OBX.5/OBX.5.1 = 'UNK' or OBX.5/OBX.5.1 = 'OTH'\">\n\t\t\t  \"valueCodeableConcept\": {\n\t\t\t\t\"coding\": [{\n\t\t\t\t  \"system\": \"http://terminology.hl7.org/CodeSystem/v3-NullFlavor\",\n\t\t\t\t  \"code\": \"<xsl:value-of select='OBX.5/OBX.5.1'/>\",\n\t\t\t\t  \"display\": \"<xsl:value-of select='OBX.5/OBX.5.2'/>\"\n\t\t\t\t}]\n\t\t\t  }\n\t\t\t</xsl:when>\n\t\t\t\n\t\t\t<xsl:otherwise>\n              \"valueCodeableConcept\" : {\n                \"coding\" : [{\n                  \"system\" : \"http://snomed.info/sct\",\n                  \"code\" : \"<xsl:value-of select='OBX.5/OBX.5.1'/>\",\n                  \"display\" : \"<xsl:value-of select='OBX.5/OBX.5.2'/>\"\n                }]\n              }\n            </xsl:otherwise>\n\n\t\t  </xsl:choose>\n\n          , \"subject\": {\n            \"reference\": \"Patient/<xsl:value-of select='$patientResourceId'/>\",\n            \"display\" : \"<xsl:value-of select='$patientResourceName'/>\"\n          }\n          <xsl:if test=\"string(OBX.14/OBX.14.1) or $currentTimestamp\">\n            , \"effectiveDateTime\": \"<xsl:choose>\n              <xsl:when test=\"string(OBX.14/OBX.14.1)\">\n                <xsl:call-template name='formatDateTime'>\n                  <xsl:with-param name='dateTime' select='OBX.14/OBX.14.1'/>\n                </xsl:call-template>\n              </xsl:when>\n              <xsl:otherwise>\n                <xsl:value-of select='$currentTimestamp'/>\n              </xsl:otherwise>\n            </xsl:choose>\"\n          </xsl:if>\n        },\n        \"request\": {\n          \"method\": \"POST\",\n          \"url\": \"<xsl:value-of select='$baseFhirUrl'/>/Observation/<xsl:value-of select='$sexualOrientationResourceId'/>\"\n        }\n      }\n  </xsl:for-each>\n</xsl:template>\n\n<!-- Observation Template -->\n  <xsl:template name=\"ObservationFromXON\">\n\t<xsl:if test=\"string(OBX.5/OBX.5.1) \n          and OBX.5/OBX.5.1 != 'UNK' \n          and string(OBX.3/OBX.3.1) \n          and OBX.3/OBX.3.1 != 'UNK'\n          \">\n      \n      <!--The observation resource will be generated only for the question codes present in the list specified in 'mapObservationCategoryCodes'-->\n      <xsl:variable name=\"questionCode\" select=\"OBX.3/OBX.3.1\"/>\n      <xsl:variable name=\"categoryCode\">\t  \n              <xsl:call-template name=\"mapObservationCategoryCodes\">\n                <xsl:with-param name=\"questionCode\" select=\"$questionCode\"/>\n              </xsl:call-template>\n            </xsl:variable>\n      <xsl:if test=\"string($categoryCode)\">\n\n          <xsl:variable name=\"observationResourceId\">\n            <xsl:call-template name=\"generateFixedLengthResourceId\">\n              <xsl:with-param name=\"prefixString\" select=\"$questionCode\"/>\n              <xsl:with-param name=\"sha256ResourceId\" select=\"$observationResourceSha256Id\"/>\n            </xsl:call-template>\n          </xsl:variable>\n          {\n            \"fullUrl\": \"<xsl:value-of select='$baseFhirUrl'/>/Observation/<xsl:value-of select='$observationResourceId'/>\",\n            \"resource\": {\n              \"resourceType\": \"Observation\",\n              \"id\": \"<xsl:value-of select='$observationResourceId'/>\",\n              \"meta\": {\n                \"lastUpdated\": \"<xsl:value-of select='$currentTimestamp'/>\",\n                \"profile\": [\"<xsl:value-of select='$observationMetaProfileUrlFull'/>\"]\n              },\n              \"status\": \"<xsl:call-template name='mapObservationStatus'>\n                            <xsl:with-param name='statusCode' select='OBX.11'/>\n                        </xsl:call-template>\",\n              \"category\": [\n                {\n                  \"coding\": [{\n                    \"system\": \"http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes\",\n                    \"code\": \"<xsl:value-of select='$categoryCode'/>\",\n                    \"display\": \"<xsl:call-template name=\"mapSDOHCategoryCodeDisplay\">\n                                  <xsl:with-param name=\"questionCode\" select=\"$questionCode\"/>\n                                  <xsl:with-param name=\"categoryCode\" select=\"$categoryCode\"/>\n                                </xsl:call-template>\"\n                  }]\n\t\t\t\t}\n\t\t\t\t  <xsl:choose>\n                        <xsl:when test=\"string($categoryCode) = 'sdoh-category-unspecified'\">\n                          <xsl:choose>\n                            <xsl:when test=\"string($questionCode)= '96782-8'\">\n                              ,{\n\t\t\t\t\t\t\t\t\"coding\": [\n\t\t\t\t\t\t\t\t{\n                                  \"system\": \"http://snomed.info/sct\",\n                                  \"code\": \"365458002\",\n                                  \"display\": \"Education and/or schooling finding\"\n                                }]\n\t\t\t\t\t\t\t\t}\n                            </xsl:when>\n                          </xsl:choose>\n                        </xsl:when>\n                      </xsl:choose>\n\t\t\t\t,{\n                  \"coding\": [{\n                      \"system\": \"http://terminology.hl7.org/CodeSystem/observation-category\",\n                      \"code\": \"social-history\"\n                  }]\n                },\n                {\n                  \"coding\": [{\n                      \"system\": \"http://terminology.hl7.org/CodeSystem/observation-category\",\n                      \"code\": \"survey\"\n                  }]\n                }\n              ],\n              \"code\": {\n                \"coding\": [\n                  {\n                    \"system\": \"http://loinc.org\",\n                    \"code\": \"<xsl:value-of select='OBX.3/OBX.3.1'/>\",\n                    \"display\": \"<xsl:value-of select='OBX.3/OBX.3.2'/>\"\n                  }\n                ]\n                <xsl:choose>\n\t\t\t\t  <xsl:when test=\"string(OBX.3/OBX.3.9)\">\n\t\t\t\t\t<xsl:text>,</xsl:text>\n\t\t\t\t\t\"text\": \"<xsl:value-of select='OBX.3/OBX.3.9'/>\"\n\t\t\t\t  </xsl:when>\n\t\t\t\t  <xsl:when test=\"string(OBX.3/OBX.3.2)\">\n\t\t\t\t\t<xsl:text>,</xsl:text>\n\t\t\t\t\t\"text\": \"<xsl:value-of select='OBX.3/OBX.3.2'/>\"\n\t\t\t\t  </xsl:when>\n\t\t\t\t</xsl:choose>\n              },\n              <!-- https://test.shinny.org/change_log.html#v150 \n                 According to v1.5.0 change log, add component element for the question code '96778-6' -->\n            <xsl:choose>\n\t\t\t\t<xsl:when test=\"string(OBX.5/OBX.5.1) = 'X-SDOH-FLO-1570000066-Patient unable to answer' \n                                  or string(OBX.5/OBX.5.1) = 'X-SDOH-FLO-1570000066-Patient declined'\">\n                      <xsl:variable name=\"dataAbsentReasonCode\">\n                        <xsl:call-template name=\"getDataAbsentReasonFhirCode\">\n                          <xsl:with-param name=\"dataAbsentReason\" select=\"string(OBX.5/OBX.5.1)\"/>\n                        </xsl:call-template>\n                      </xsl:variable>\n                      \"dataAbsentReason\": {\n                          \"coding\": [\n                              {\n                                  \"system\": \"http://terminology.hl7.org/CodeSystem/data-absent-reason\",\n                                  \"code\": \"<xsl:value-of select=\"$dataAbsentReasonCode\"/>\",\n                                  \"display\": \"<xsl:call-template name=\"getDataAbsentReasonFhirDisplay\">\n                                                <xsl:with-param name=\"dataAbsentReasonCode\" select=\"$dataAbsentReasonCode\"/>\n                                              </xsl:call-template>\"\n                              }\n                          ]\n                      },\n                </xsl:when>\n\t\t\t  <xsl:when test=\"string(OBX.3/OBX.3.1) = '96778-6'\">\n\t\t\t\t\"component\": [\n\t\t\t\t  {\n\t\t\t\t\t\"code\": {\n\t\t\t\t\t  \"coding\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t  \"system\": \"http://loinc.org\",\n\t\t\t\t\t\t  \"code\": \"<xsl:value-of select='OBX.3/OBX.3.1'/>\",\n\t\t\t\t\t\t  \"display\": \"<xsl:value-of select='OBX.3/OBX.3.2'/>\"\n\t\t\t\t\t\t}\n\t\t\t\t\t  ]\n\t\t\t\t\t  <xsl:choose>\n\t\t\t\t\t\t<xsl:when test=\"string(OBX.3/OBX.3.9)\">\n\t\t\t\t\t\t  <xsl:text>,</xsl:text> \"text\": \"<xsl:value-of select='OBX.3/OBX.3.9'/>\"\n\t\t\t\t\t\t</xsl:when>\n\t\t\t\t\t\t<xsl:when test=\"string(OBX.3/OBX.3.2)\">\n\t\t\t\t\t\t  <xsl:text>,</xsl:text> \"text\": \"<xsl:value-of select='OBX.3/OBX.3.2'/>\"\n\t\t\t\t\t\t</xsl:when>\n\t\t\t\t\t  </xsl:choose>\n\t\t\t\t\t},\n\t\t\t\t\t\"valueCodeableConcept\": {\n\t\t\t\t\t  \"coding\": <xsl:value-of select='$componentAnswersXml'/>\n\t\t\t\t\t}\n\t\t\t\t  }\n\t\t\t\t],\n\t\t\t  </xsl:when>\n\t\t\t  <xsl:when test=\"string(OBX.3/OBX.3.1) = '95614-4'\">\n\t\t\t\t\"valueCodeableConcept\": {\n\t\t\t\t\t\"coding\": [{\n\t\t\t\t\t  \"system\": \"http://unitsofmeasure.org\",\n\t\t\t\t\t  \"display\": \"{Number}\"\n\t\t\t\t\t}]\n\t\t\t\t\t<xsl:text>,</xsl:text> \"text\": \"<xsl:value-of select='OBX.5/OBX.5.1'/>\"\n\t\t\t\t  },\n\t\t\t\t  \n\t\t\t\t  \"derivedFrom\": [\n\t\t\t\t\t  <!-- Declare derivedFrom LOINC codes -->\n\t\t\t\t\t  <xsl:variable name=\"derivedFromCodes\" select=\"'|95618-5|95617-7|95616-9|95615-1|'\" />\n\n\t\t\t\t\t  <!-- Loop through all OBX segments globally and filter by code -->\n\t\t\t\t\t  <xsl:for-each select=\"//OBX[\n\t\t\t\t\t\t\t\t\t\t\t  contains($derivedFromCodes, concat('|', normalize-space(OBX.3/OBX.3.1), '|'))\n\t\t\t\t\t\t\t\t\t\t\t  and not(preceding::OBX[\n\t\t\t\t\t\t\t\t\t\t\t\tnormalize-space(OBX.3/OBX.3.1) = normalize-space(current()/OBX.3/OBX.3.1)\n\t\t\t\t\t\t\t\t\t\t\t  ])\n\t\t\t\t\t\t\t\t\t\t\t]\">\n\t\t\t\t\t\t<xsl:variable name=\"code\" select=\"normalize-space(OBX.3/OBX.3.1)\"/>\n\t\t\t\t\t\t<xsl:variable name=\"observationResourceId\">\n\t\t\t\t\t\t  <xsl:call-template name=\"generateFixedLengthResourceId\">\n\t\t\t\t\t\t\t<xsl:with-param name=\"prefixString\" select=\"$code\"/>\n\t\t\t\t\t\t\t<xsl:with-param name=\"sha256ResourceId\" select=\"$observationResourceSha256Id\"/>\n\t\t\t\t\t\t  </xsl:call-template>\n\t\t\t\t\t\t</xsl:variable>\n\t\t\t\t\t\t{ \"reference\": \"Observation/<xsl:value-of select='$observationResourceId'/>\" }\n\t\t\t\t\t\t<xsl:if test=\"position() != last()\">,</xsl:if>\n\t\t\t\t\t  </xsl:for-each>\n\t\t\t\t\t],\n\t\t\t  </xsl:when>\n\t\t\t  <xsl:otherwise>\n\t\t\t\t  \"valueCodeableConcept\": {\n\t\t\t\t\t\"coding\": [{\n\t\t\t\t\t  \"system\": \"http://loinc.org\",\n\t\t\t\t\t  \"code\": \"<xsl:value-of select='OBX.5/OBX.5.1'/>\",\n\t\t\t\t\t  \"display\": \"<xsl:value-of select='OBX.5/OBX.5.2'/>\"\n\t\t\t\t\t}]\n\t\t\t\t\t<xsl:choose>\n\t\t\t\t\t  <xsl:when test=\"string(OBX.5/OBX.5.9)\">\n\t\t\t\t\t\t<xsl:text>,</xsl:text> \"text\": \"<xsl:value-of select='OBX.5/OBX.5.9'/>\"\n\t\t\t\t\t  </xsl:when>\n\t\t\t\t\t  <xsl:when test=\"string(OBX.5/OBX.5.2)\">\n\t\t\t\t\t\t<xsl:text>,</xsl:text> \"text\": \"<xsl:value-of select='OBX.5/OBX.5.2'/>\"\n\t\t\t\t\t  </xsl:when>\n\t\t\t\t\t</xsl:choose>\n\t\t\t\t  },\n\t\t\t  </xsl:otherwise>\n\t\t\t</xsl:choose>\n              \"subject\": {\n                \"reference\": \"Patient/<xsl:value-of select='$patientResourceId'/>\",\n                \"display\": \"<xsl:value-of select=\"$patientResourceName\"/>\"\n              }\n              <xsl:if test=\"normalize-space($encounterResourceId) != '' and $encounterResourceId != 'null'\">\n              , \"encounter\": {\n                  \"reference\": \"Encounter/<xsl:value-of select='$encounterResourceId'/>\"\n                }\n              </xsl:if>\n              <xsl:if test=\"string(OBX.14/OBX.14.1) or $currentTimestamp\">\n\t\t\t\t  <xsl:text>,</xsl:text>\n\t\t\t\t  \"effectiveDateTime\": \"<xsl:choose>\n\t\t\t\t\t<xsl:when test=\"string(OBX.14/OBX.14.1)\">\n\t\t\t\t\t  <xsl:call-template name='formatDateTime'>\n\t\t\t\t\t\t<xsl:with-param name='dateTime' select='OBX.14/OBX.14.1'/>\n\t\t\t\t\t  </xsl:call-template>\n\t\t\t\t\t</xsl:when>\n\t\t\t\t\t<xsl:otherwise>\n\t\t\t\t\t  <xsl:value-of select='$currentTimestamp'/>\n\t\t\t\t\t</xsl:otherwise>\n\t\t\t\t  </xsl:choose>\"\n\t\t\t\t</xsl:if>\n              <xsl:if test=\"string($organizationResourceId)\">\n              , \"performer\": [{\n                            \"reference\": \"Organization/<xsl:value-of select='$organizationResourceId'/>\"\n                        }]\n              </xsl:if>\n\t\t\t  <xsl:if test=\"normalize-space(OBX.8/OBX.8.1)\">\n\t\t\t\t,\"interpretation\": [\n\t\t\t\t\t  {\n\t\t\t\t\t\t\"coding\": [\n\t\t\t\t\t\t  {\n\t\t\t\t\t\t\t\"system\": \"http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation\",\n\t\t\t\t\t\t\t\"code\": \"<xsl:value-of select='normalize-space(OBX.8/OBX.8.1)'/>\",\n\t\t\t\t\t\t\t\"display\": \"<xsl:value-of select='normalize-space(OBX.8/OBX.8.2)'/>\"\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t]\n\t\t\t\t\t  }\n\t\t\t\t\t]\n\t\t\t</xsl:if>\n            },\n            \"request\": {\n              \"method\": \"POST\",\n              \"url\": \"<xsl:value-of select='$baseFhirUrl'/>/Observation/<xsl:value-of select='$observationResourceId'/>\"\n            }\n          }\n      </xsl:if>\n    </xsl:if>\n  </xsl:template>\n\n  <!-- Organization Template -->\n<xsl:template name=\"OrganizationFromXON\">\n    {\n      \"fullUrl\" : \"<xsl:value-of select='$baseFhirUrl'/>/Organization/<xsl:value-of select=\"$organizationResourceId\"/>\",\n      \"resource\": {\n        \"resourceType\": \"Organization\",\n        \"id\": \"<xsl:value-of select=\"$organizationResourceId\"/>\",\n        \"meta\" : {\n          \"lastUpdated\" : \"<xsl:value-of select='$currentTimestamp'/>\",\n          \"profile\" : [\"<xsl:value-of select='$organizationMetaProfileUrlFull'/>\"]\n        },\n        \"active\": true,\n        \n        <xsl:if test=\"$organizationNPI or $organizationTIN\">\n          \"identifier\": [\n            <xsl:choose>\n\n              <!-- NPI -->\n              <xsl:when test=\"$organizationNPI\">\n                {\n                  \"use\": \"official\",\n                  \"type\": {\n                    \"coding\": [\n                      {\n                        \"system\": \"http://terminology.hl7.org/CodeSystem/v2-0203\",\n                        \"code\": \"NPI\",\n                        \"display\": \"National Provider Identifier\"\n                      }\n                    ]\n                  },\n                  \"system\": \"http://hl7.org/fhir/sid/us-npi\",\n                  \"value\": \"<xsl:value-of select='$organizationNPI'/>\"\n                }\n              </xsl:when>\n\n              <!-- TAX -->\n              <xsl:when test=\"$organizationTIN\">\n                {\n                  \"use\": \"official\",\n                  \"type\": {\n                    \"coding\": [\n                      {\n                        \"system\": \"http://terminology.hl7.org/CodeSystem/v2-0203\",\n                        \"code\": \"TAX\",\n                        \"display\": \"Tax ID Number\"\n                      }\n                    ]\n                  },\n                  \"system\": \"http://www.irs.gov/\",\n                  \"value\": \"<xsl:value-of select='$organizationTIN'/>\"\n                }\n              </xsl:when>\n            </xsl:choose>\n          ],\n        </xsl:if>\n\t\t\n        \"name\": \"<xsl:choose>\n           <xsl:when test='normalize-space($OrganizationName)'>\n             <xsl:value-of select='$OrganizationName'/>\n           </xsl:when>\n           <xsl:otherwise>\n             <xsl:value-of select='//MSH/MSH.6'/>\n           </xsl:otherwise>\n         </xsl:choose>\"\n\n        <xsl:if test=\"//ORC.23\">\n\t\t  , \"telecom\": [\n\t\t\t<xsl:for-each select=\"//ORC.23\">\n\t\t\t  {\n\t\t\t\t<xsl:if test=\"string(//ORC.23.1)\">\n\t\t\t\t  \"value\": \"<xsl:value-of select='//ORC.23.1'/>\"\n\t\t\t\t</xsl:if>\n\t\t\t\t<xsl:if test=\"string(//ORC.23.3)\">\n\t\t\t\t  <xsl:if test=\"string(//ORC.23.1)\">, </xsl:if>\n\t\t\t\t  \"system\": \"<xsl:choose>\n\t\t\t\t\t<xsl:when test=\"//ORC.23.3 = 'PH'\">phone</xsl:when>\n\t\t\t\t\t<xsl:when test=\"//ORC.23.3 = 'FX'\">fax</xsl:when>\n\t\t\t\t\t<xsl:when test=\"//ORC.23.3 = 'Internet'\">email</xsl:when>\n\t\t\t\t\t<xsl:otherwise>other</xsl:otherwise>\n\t\t\t\t  </xsl:choose>\"\n\t\t\t\t</xsl:if>\n\t\t\t\t<xsl:if test=\"string(//ORC.23.2)\">\n\t\t\t\t  <xsl:if test=\"string(//ORC.23.1) or string(//ORC.23.3)\">, </xsl:if>\n\t\t\t\t  \"use\": \"<xsl:choose>\n\t\t\t\t\t<xsl:when test=\"//ORC.23.2 = 'WP'\">work</xsl:when>\n\t\t\t\t\t<xsl:when test=\"//ORC.23.2 = 'H'\">home</xsl:when>\n\t\t\t\t\t<xsl:when test=\"//ORC.23.2 = 'TMP'\">temp</xsl:when>\n\t\t\t\t\t<xsl:when test=\"//ORC.23.2 = 'MC' or ORC.23.2 = 'PG'\">mobile</xsl:when>\n\t\t\t\t\t<xsl:otherwise><xsl:value-of select='//ORC.23.2'/></xsl:otherwise>\n\t\t\t\t  </xsl:choose>\"\n\t\t\t\t</xsl:if>\n\t\t\t  }<xsl:if test=\"position() != last()\">,</xsl:if>\n\t\t\t</xsl:for-each>\n\t\t  ]\n\t\t</xsl:if>\n        <xsl:if test=\"//ORC.22\">\n\t\t  , \"address\": [\n\t\t\t<xsl:for-each select=\"//ORC.22\">\n\t\t\t  {\n\t\t\t\t<xsl:variable name=\"comma\" select=\"false()\" />\n\t\t\t\t<xsl:if test=\"string(ORC.22.7)\">\n\t\t\t\t  \"use\": \"<xsl:choose>\n\t\t\t\t\t\t\t<xsl:when test=\"ORC.22.7 = 'H' or ORC.22.7 = 'HP'\">home</xsl:when>\n\t\t\t\t\t\t\t<xsl:when test=\"ORC.22.7 = 'WP'\">work</xsl:when>\n\t\t\t\t\t\t\t<xsl:when test=\"ORC.22.7 = 'TMP'\">temp</xsl:when>\n\t\t\t\t\t\t\t<xsl:when test=\"ORC.22.7 = 'OLD' or ORC.22.7 = 'BAD'\">old</xsl:when>\n\t\t\t\t\t\t\t<xsl:otherwise><xsl:value-of select=\"ORC.22.7\"/></xsl:otherwise>\n\t\t\t\t\t\t </xsl:choose>\"\n\t\t\t\t  <xsl:text>,</xsl:text>\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<xsl:if test=\"string(ORC.22.1) or string(ORC.22.2) or string(ORC.22.3) or string(ORC.22.4) or string(ORC.22.5) or string(ORC.22.6)\">\n\t\t\t\t  \"text\": \"<xsl:value-of select=\"normalize-space(concat(ORC.22.1, ' ', ORC.22.2, ' ', ORC.22.3, ' ', ORC.22.4, ' ', ORC.22.5, ' ', ORC.22.6))\"/>\"\n\t\t\t\t  <xsl:if test=\"string(ORC.22.1) or string(ORC.22.2)\">,<xsl:text/></xsl:if>\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<xsl:if test=\"string(ORC.22.1) or string(ORC.22.2)\">\n\t\t\t\t  \"line\": [\n\t\t\t\t\t<xsl:if test=\"string(ORC.22.1)\">\n\t\t\t\t\t  \"<xsl:value-of select='ORC.22.1'/>\"<xsl:if test=\"string(ORC.22.2)\">,</xsl:if>\n\t\t\t\t\t</xsl:if>\n\t\t\t\t\t<xsl:if test=\"string(ORC.22.2)\">\n\t\t\t\t\t  \"<xsl:value-of select='ORC.22.2'/>\"\n\t\t\t\t\t</xsl:if>\n\t\t\t\t  ]\n\t\t\t\t  <xsl:if test=\"string(ORC.22.3) or string(ORC.22.4) or string(ORC.22.5) or string(ORC.22.6) or string(ORC.22.9)\">,<xsl:text/></xsl:if>\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<xsl:if test=\"string(ORC.22.3)\">\n\t\t\t\t  \"city\": \"<xsl:value-of select='ORC.22.3'/>\"<xsl:if test=\"string(ORC.22.4) or string(ORC.22.5) or string(ORC.22.6) or string(ORC.22.9)\">,<xsl:text/></xsl:if>\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<xsl:if test=\"string(ORC.22.9)\">\n\t\t\t\t  \"district\": \"<xsl:value-of select='ORC.22.9'/>\"<xsl:if test=\"string(ORC.22.4) or string(ORC.22.5) or string(ORC.22.6)\">,<xsl:text/></xsl:if>\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<xsl:if test=\"string(ORC.22.4)\">\n\t\t\t\t  \"state\": \"<xsl:value-of select='ORC.22.4'/>\"<xsl:if test=\"string(ORC.22.5) or string(ORC.22.6)\">,<xsl:text/></xsl:if>\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<xsl:if test=\"string(ORC.22.5)\">\n\t\t\t\t  \"postalCode\": \"<xsl:value-of select='ORC.22.5'/>\"<xsl:if test=\"string(ORC.22.6)\">,<xsl:text/></xsl:if>\n\t\t\t\t</xsl:if>\n\n\t\t\t\t<xsl:if test=\"string(ORC.22.6)\">\n\t\t\t\t  \"country\": \"<xsl:value-of select='ORC.22.6'/>\"\n\t\t\t\t</xsl:if>\n\t\t\t  }<xsl:if test=\"position() != last()\">,</xsl:if>\n\t\t\t</xsl:for-each>\n\t\t  ]\n\t\t</xsl:if>\n      },\n      \"request\" : {\n        \"method\" : \"POST\",\n        \"url\" : \"<xsl:value-of select='$baseFhirUrl'/>/Organization/<xsl:value-of select=\"$organizationResourceId\"/>\"\n      }\n    }\n  </xsl:template>\n\n\n<!-- Encounter Template -->\n  <xsl:template name=\"EncounterFromPV\">\n  {\n    \"fullUrl\": \"<xsl:value-of select='$baseFhirUrl'/>/Encounter/<xsl:value-of select='$encounterResourceId'/>\",\n    \"resource\": {\n      \"resourceType\": \"Encounter\",\n      \"id\": \"<xsl:value-of select='$encounterResourceId'/>\",\n      \"meta\": {\n        \"lastUpdated\": \"<xsl:value-of select='$currentTimestamp'/>\",\n        \"profile\": [\n          \"<xsl:value-of select='$encounterMetaProfileUrlFull'/>\"\n        ]\n      },\n      <!-- \"status\": \"<xsl:call-template name='mapEncounterStatusFromHL7'/>\" -->\n\t  \"status\": \"finished\"\n\n      <xsl:if test=\"string(//PV1/PV1.2/PV1.2.1)\">\n\t\t  <xsl:text>,</xsl:text>\n\t\t  \"class\": {\n\t\t\t\"system\": \"http://terminology.hl7.org/CodeSystem/v3-ActCode\",\n\t\t\t<xsl:choose>\n\t\t\t  <xsl:when test=\"//PV1/PV1.2/PV1.2.1 = 'I'\">\n\t\t\t\t\"code\": \"IMP\",\n\t\t\t\t\"display\": \"inpatient encounter\"\n\t\t\t  </xsl:when>\n\t\t\t  <xsl:when test=\"//PV1/PV1.2/PV1.2.1 = 'E'\">\n\t\t\t\t\"code\": \"EMER\",\n\t\t\t\t\"display\": \"emergency\"\n\t\t\t  </xsl:when>\n\t\t\t  <xsl:when test=\"//PV1/PV1.2/PV1.2.1 = 'O'\">\n\t\t\t\t\"code\": \"AMB\",\n\t\t\t\t\"display\": \"ambulatory\"\n\t\t\t  </xsl:when>\n\t\t\t  <xsl:when test=\"//PV1/PV1.2/PV1.2.1 = 'P'\">\n\t\t\t\t\"code\": \"PRENC\",\n\t\t\t\t\"display\": \"pre-admission\"\n\t\t\t  </xsl:when>\n\t\t\t  <xsl:otherwise>\n\t\t\t\t\"code\": \"<xsl:value-of select='//PV1/PV1.2/PV1.2.1'/>\",\n\t\t\t\t\"display\": \"<xsl:value-of select='//PV1/PV1.2/PV1.2.2'/>\"\n\t\t\t  </xsl:otherwise>\n\t\t\t</xsl:choose>\n\t\t  }\n\t\t</xsl:if>\n\n\n\t <xsl:variable name=\"type\" select=\"$encounterType\"/>\n      <xsl:if test=\"$type\">\n        <xsl:text>,</xsl:text>\n        \"type\": [\n          <xsl:if test=\"$type\">\n            {\n\t\t\t  \"coding\": [{\n\t\t\t\t\"system\": \"http://snomed.info/sct\",\n\t\t\t\t\"code\": \"<xsl:value-of select='$type'/>\",\n\t\t\t\t\"display\": \"<xsl:choose>\n\t\t\t\t\t\t\t  <xsl:when test='$type = \"405672008\"'>Direct questioning (procedure)</xsl:when>\n\t\t\t\t\t\t\t  <xsl:when test='$type = \"23918007\"'>History taking, self-administered, by computer terminal</xsl:when>\n\t\t\t\t\t\t\t  <xsl:otherwise><xsl:value-of select='//PV1/PV1.4/PV1.4.2'/></xsl:otherwise>\n\t\t\t\t\t\t\t</xsl:choose>\"\n\t\t\t  }],\n\t\t\t  \"text\": \"<xsl:choose>\n\t\t\t\t\t\t <xsl:when test='$type = \"405672008\"'>Direct questioning (procedure)</xsl:when>\n\t\t\t\t\t\t <xsl:when test='$type = \"23918007\"'>History taking, self-administered, by computer terminal</xsl:when>\n\t\t\t\t\t\t <xsl:otherwise><xsl:value-of select='//PV1/PV1.4/PV1.4.9'/></xsl:otherwise>\n\t\t\t\t\t   </xsl:choose>\"\n\t\t\t}\n          </xsl:if>\n        ]\n      </xsl:if>\n\n      <xsl:if test=\"string(//PV1/PV1.44/PV1.44.1) or string(//PV1/PV1.45/PV1.45.1)\">\n        <xsl:text>,</xsl:text>\n        \"period\": {\n          <xsl:if test=\"string(//PV1/PV1.44/PV1.44.1)\">\n            \"start\": \"<xsl:call-template name='formatDateTime'>\n                        <xsl:with-param name='dateTime' select='//PV1/PV1.44/PV1.44.1'/>\n                      </xsl:call-template>\"\n            <xsl:if test=\"string(//PV1/PV1.45/PV1.45.1)\">,</xsl:if>\n          </xsl:if>\n          <xsl:if test=\"string(//PV1/PV1.45/PV1.45.1)\">\n            \"end\": \"<xsl:call-template name='formatDateTime'>\n                      <xsl:with-param name='dateTime' select='//PV1/PV1.45/PV1.45.1'/>\n                    </xsl:call-template>\"\n          </xsl:if>\n        }\n      </xsl:if>\n\n      <xsl:text>,</xsl:text>\n      \"subject\": {\n        \"reference\": \"Patient/<xsl:value-of select='$patientResourceId'/>\",\n        \"display\": \"<xsl:value-of select='normalize-space(concat(\n\t\t  //PID/PID.5/PID.5.1, &quot; &quot;, \n\t\t  //PID/PID.5/PID.5.2, &quot; &quot;, \n\t\t  //PID/PID.5/PID.5.3, &quot;  &quot;, \n\t\t  //PID/PID.9/PID.9.1, &quot; &quot;, \n\t\t  //PID/PID.9/PID.9.2, &quot; &quot;, \n\t\t  //PID/PID.9/PID.9.3\n\t\t))'/>\"\n\n      }\n\n\t\t<xsl:if test=\"(//OBR.32/OBR.32.1 or //OBR.34/OBR.34.1) and (//ROL/ROL.4/ROL.4.3 or //ROL/ROL.4/ROL.4.2)\">\n\t\t\t<xsl:text>,</xsl:text>\n\t\t\t\"participant\": [{\n\t\t\t  \"type\": [{\n\t\t\t\t\"coding\": [{\n\t\t\t\t  \"system\": \"http://terminology.hl7.org/CodeSystem/v3-ParticipationType\",\n\t\t\t\t  \"code\": \"<xsl:choose>\n\t\t\t\t\t\t   <xsl:when test='normalize-space(//OBR.32/OBR.32.1)'>\n\t\t\t\t\t\t\t <xsl:value-of select='substring-before(//OBR.32/OBR.32.1, \"&amp;\")'/>\n\t\t\t\t\t\t   </xsl:when>\n\t\t\t\t\t\t   <xsl:when test='normalize-space(//OBR.34/OBR.34.1)'>\n\t\t\t\t\t\t\t <xsl:value-of select='substring-before(//OBR.34/OBR.34.1, \"&amp;\")'/>\n\t\t\t\t\t\t   </xsl:when>\n\t\t\t\t\t\t </xsl:choose>\",\n\n\t\t\t\t\"display\": \"<xsl:choose>\n\t\t\t\t\t  <xsl:when test='normalize-space(//OBR.32/OBR.32.1)'>\n\t\t\t\t\t\t<xsl:variable name='fv32' select='//OBR.32/OBR.32.1'/>\n\t\t\t\t\t\t<xsl:variable name='after32' select='substring-after($fv32, \"&amp;\")'/>\n\t\t\t\t\t\t<xsl:variable name='sub2_32' select='substring-before($after32, \"&amp;\")'/>\n\t\t\t\t\t\t<xsl:variable name='sub3_32' select='substring-after($after32, \"&amp;\")'/>\n\t\t\t\t\t\t<xsl:value-of select='normalize-space(concat($sub3_32, \" \", $sub2_32))'/>\n\t\t\t\t\t  </xsl:when>\n\n\t\t\t\t\t  <xsl:when test='normalize-space(//OBR.34/OBR.34.1)'>\n\t\t\t\t\t\t<xsl:variable name='fv34' select='//OBR.34/OBR.34.1'/>\n\t\t\t\t\t\t<xsl:variable name='after34' select='substring-after($fv34, \"&amp;\")'/>\n\t\t\t\t\t\t<xsl:variable name='sub2_34' select='substring-before($after34, \"&amp;\")'/>\n\t\t\t\t\t\t<xsl:variable name='sub3_34' select='substring-after($after34, \"&amp;\")'/>\n\t\t\t\t\t\t<xsl:value-of select='normalize-space(concat($sub3_34, \" \", $sub2_34))'/>\n\t\t\t\t\t  </xsl:when>\n\n\t\t\t\t\t</xsl:choose>\"\n\t\t\t\t}]\n\t\t\t  }],\n\t\t\t  \"individual\": {\n\t\t\t\t<!-- \"reference\": \"Practitioner/<xsl:value-of select='//ROL/ROL.4/ROL.4.1'/>\", -->\n\t\t\t\t\"display\": \"<xsl:value-of select='normalize-space(concat(//ROL/ROL.4/ROL.4.3, &quot; &quot;, //ROL/ROL.4/ROL.4.2))'/>\"\n\t\t\t  }\n\t\t\t}]\n\t\t</xsl:if>\n\n      <xsl:if test=\"string(//PV1/PV1.3/PV1.3.1)\">\n        <xsl:text>,</xsl:text>\n        \"location\": [{\n          \"location\": {\n            <!-- \"reference\": \"Location/<xsl:value-of select='//PV1/PV1.3/PV1.3.1'/>\", -->\n            \"display\": \"<xsl:choose>\n\t\t\t  <xsl:when test='string(//PV1/PV1.3/PV1.3.4)'>\n\t\t\t\t<xsl:value-of select='//PV1/PV1.3/PV1.3.4'/>\n\t\t\t  </xsl:when>\n\t\t\t  <xsl:otherwise>\n\t\t\t\t<xsl:value-of select='//PV1/PV1.3/PV1.3.7'/>\n\t\t\t  </xsl:otherwise>\n\t\t\t</xsl:choose>\"\n          }\n        }]\n      </xsl:if>\n\n      <xsl:if test=\"string(//PL.1) or string(//PL.6)\">\n\t  <xsl:text>,</xsl:text>\n\t  \"serviceProvider\": {\n\t\t<xsl:if test=\"string(//PL.1)\">\n\t\t  \"reference\": \"Organization/<xsl:value-of select='//PL.1'/>\"\n\t\t  <xsl:if test=\"string(//PL.6)\">,</xsl:if>\n\t\t</xsl:if>\n\t\t<xsl:if test=\"string(//PL.6)\">\n\t\t  \"display\": \"<xsl:value-of select='//PL.6'/>\"\n\t\t</xsl:if>\n\t  }\n\t</xsl:if>\n    },\n    \"request\": {\n      \"method\": \"POST\",\n      \"url\": \"<xsl:value-of select='$baseFhirUrl'/>/Encounter/<xsl:value-of select='$encounterResourceId'/>\"\n    }\n  }\n</xsl:template>\n\n\n<!-- Consent Template -->\n  <xsl:template name=\"ConsentFromOBX\">\n  <xsl:variable name=\"consentOBX\" select=\"//OBX[normalize-space(OBX.3/OBX.3.2) = 'AHC-HRSN Patient Consent'][1]\"/>\n  \n   <!-- Define boolean: is consent given -->\n  <xsl:variable name=\"isConsentGiven\"\n                select=\"contains(normalize-space($consentOBX/OBX.5/OBX.5.1), 'Patient Consents') or \n                        contains(normalize-space($consentOBX/OBX.5/OBX.5.1), 'Yes')\"/>\n\t\t\t\t\t\t\n  {\n    \"fullUrl\": \"<xsl:value-of select='$baseFhirUrl'/>/Consent/<xsl:value-of select='$consentResourceId'/>\",\n    \"resource\": {\n      \"resourceType\": \"Consent\",\n      \"id\": \"<xsl:value-of select='$consentResourceId'/>\",\n      \"meta\": {\n        \"lastUpdated\": \"<xsl:value-of select='$currentTimestamp'/>\",\n        \"profile\": [\"<xsl:value-of select='$consentMetaProfileUrlFull'/>\"]\n      },\n      \"status\": \"<xsl:choose>\n        <xsl:when test='$isConsentGiven'>active</xsl:when>\n        <xsl:otherwise>rejected</xsl:otherwise>\n      </xsl:choose>\",\n      \"scope\": {\n        \"coding\": [{\n          \"system\": \"http://terminology.hl7.org/CodeSystem/consentscope\",\n          \"code\": \"treatment\",\n          \"display\": \"Treatment\"\n        }],\n        \"text\": \"treatment\"\n      },\n      \"category\": [\n        {\n          \"coding\": [{\n            \"system\": \"http://loinc.org\",\n            \"code\": \"59284-0\",\n            \"display\": \"Consent Document\"\n          }]\n        },\n        {\n          \"coding\": [{\n            \"system\": \"http://terminology.hl7.org/CodeSystem/v3-ActCode\",\n            \"code\": \"IDSCL\"\n          }]\n        }\n      ]\n      <xsl:if test=\"$consentOBX/OBX.14/OBX.14.1 or $currentTimestamp\">\n        , \"dateTime\": \"<xsl:choose>\n          <xsl:when test='$consentOBX/OBX.14/OBX.14.1'>\n            <xsl:call-template name=\"formatDateTime\">\n              <xsl:with-param name=\"dateTime\" select=\"$consentOBX/OBX.14/OBX.14.1\"/>\n            </xsl:call-template>\n          </xsl:when>\n          <xsl:otherwise><xsl:value-of select=\"$currentTimestamp\"/></xsl:otherwise>\n        </xsl:choose>\"\n      </xsl:if>,\n      \"patient\": {\n        \"reference\": \"Patient/<xsl:value-of select='$patientResourceId'/>\"\n      },\n      \"organization\": [{\n        \"reference\": \"Organization/<xsl:value-of select='$organizationResourceId'/>\"\n      }],\n      \"provision\": {\n        \"type\": \"<xsl:choose>\n          <xsl:when test='$isConsentGiven'>permit</xsl:when>\n          <xsl:otherwise>deny</xsl:otherwise>\n        </xsl:choose>\"\n      },\n      \"policy\": [{\n        \"authority\": \"urn:uuid:d1eaac1a-22b7-4bb6-9c62-cc95d6fdf1a5\"\n      }],\n      \"sourceAttachment\": {\n        \"contentType\": \"application/pdf\",\n        \"language\": \"en\"\n      }\n    },\n    \"request\": {\n      \"method\": \"POST\",\n      \"url\": \"<xsl:value-of select='$baseFhirUrl'/>/Consent/<xsl:value-of select='$consentResourceId'/>\"\n    }\n  }\n  \n</xsl:template>\n\n<!-- Grouper Observation from HL7 OBX Template -->\n<xsl:template name=\"GrouperObservationFromOBR\">\n  <!-- Loop through each OBR (i.e., one screening panel per OBR) -->\n  <xsl:for-each select=\"//OBR[substring-before(OBR.26, '&amp;') = '96777-8' or substring-before(OBR.26, '&amp;') = '97023-6' or substring-before(OBR.26, '&amp;') = 'NYSAHCHRSN' or substring-before(OBR.26, '&amp;') = 'NYS-AHC-HRSN']\">\n    <xsl:variable name=\"screeningCode\" select=\"substring-before(OBR.26, '&amp;')\"/>\n    <xsl:variable name=\"screeningDisplay\" select=\"normalize-space(substring-before(substring-after(OBR.26, '&amp;'), '&amp;'))\"/>\n\t  \n\t  <xsl:variable name=\"obrCode\" select=\"substring-before(OBR.26, '&amp;')\"/>\n\t  <xsl:variable name=\"grouperObservationResourceId\">\n            <xsl:call-template name=\"generateFixedLengthResourceId\">\n              <xsl:with-param name=\"prefixString\" select=\"$obrCode\"/>\n              <xsl:with-param name=\"sha256ResourceId\" select=\"$grouperObservationResourceSha256Id\"/>\n            </xsl:call-template>\n          </xsl:variable>\n\n    ,{\n      \"fullUrl\": \"<xsl:value-of select='$baseFhirUrl'/>/Observation/<xsl:value-of select='$grouperObservationResourceId'/>\",\n\t   <!-- \"fullUrl\": \"<xsl:value-of select='$baseFhirUrl'/>/Observation/<xsl:value-of select='concat($grouperObservationResourceSha256Id, $screeningCode)'/>\", -->\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"<xsl:value-of select='$grouperObservationResourceId'/>\",\n        \"meta\": {\n          \"lastUpdated\": \"<xsl:value-of select='$currentTimestamp'/>\",\n          \"profile\": [\"<xsl:value-of select='$observationMetaProfileUrlFull'/>\"]\n        },\n        \"status\": \"<xsl:call-template name='mapObservationStatus'>\n                            <xsl:with-param name='statusCode' select='OBX.11'/>\n                        </xsl:call-template>\",\n        \"code\": {\n          \"coding\": [{\n            \"system\": \"http://loinc.org\",\n            \"code\": \"<xsl:value-of select='$screeningCode'/>\",\n            \"display\": \"<xsl:value-of select='$screeningDisplay'/>\"\n          }]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/<xsl:value-of select='$patientResourceId'/>\",\n          \"display\": \"<xsl:value-of select='$patientResourceName'/>\"\n        },\n        <xsl:if test=\"string($organizationResourceId)\">\n          \"performer\": [{\n            \"reference\": \"Organization/<xsl:value-of select='$organizationResourceId'/>\"\n          }],\n        </xsl:if>\n\t\t<xsl:if test=\"normalize-space($encounterResourceId) != '' and $encounterResourceId != 'null'\">\n              \"encounter\": {\n                  \"reference\": \"Encounter/<xsl:value-of select='$encounterResourceId'/>\"\n                },\n              </xsl:if>\n              <xsl:if test=\"string(OBX.14/OBX.14.1) or $currentTimestamp\">\n\t\t\t\t  \"effectiveDateTime\": \"<xsl:choose>\n\t\t\t\t\t<xsl:when test=\"string(OBX.14/OBX.14.1)\">\n\t\t\t\t\t  <xsl:call-template name='formatDateTime'>\n\t\t\t\t\t\t<xsl:with-param name='dateTime' select='OBX.14/OBX.14.1'/>\n\t\t\t\t\t  </xsl:call-template>\n\t\t\t\t\t</xsl:when>\n\t\t\t\t\t<xsl:otherwise>\n\t\t\t\t\t  <xsl:value-of select='$currentTimestamp'/>\n\t\t\t\t\t</xsl:otherwise>\n\t\t\t\t  </xsl:choose>\"\n\t\t\t\t  <xsl:text>,</xsl:text>\n\t\t\t\t</xsl:if>\n\t\t<xsl:if test=\"//OBX.8.1\">\n\t\t\"interpretation\": [\n              {\n                \"coding\": [\n                  {\n                    \"system\": \"http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation\",\n                    \"code\": \"<xsl:value-of select='//OBX.8.1'/>\",\n                    \"display\": \"<xsl:value-of select='//OBX.8.2'/>\"\n                  }\n                ]\n              }\n            ],\n\t\t</xsl:if>\n        \"category\": [\n\t\t  {\n                \"coding\":\n                  <xsl:value-of select='$categoryXml'/>\n              },\n          {\n            \"coding\": [{\n              \"system\": \"http://terminology.hl7.org/CodeSystem/observation-category\",\n              \"code\": \"social-history\"\n            }]\n          },\n          {\n            \"coding\": [{\n              \"system\": \"http://terminology.hl7.org/CodeSystem/observation-category\",\n              \"code\": \"survey\"\n            }]\n          }\n        ],\n        \"hasMember\": [\n\t\t  <!-- Declare allowed LOINC codes -->\n\t\t  <xsl:variable name=\"allowedCodes\" select=\"'|71802-3|96778-6|96779-4|88122-7|88123-5|93030-5|96780-2|96782-8|95618-5|95617-7|95616-9|95615-1|95614-4|'\" />\n\t\t  \n\t\t  <!-- Loop through OBX siblings under the current OBR and filter -->\n\t\t  <xsl:for-each select=\"following-sibling::OBX[\n\t\t\t\t\t\t\t\t  generate-id(preceding-sibling::OBR[1]) = generate-id(current())\n\t\t\t\t\t\t\t\t  and normalize-space(OBX.3/OBX.3.2) != 'AHC-HRSN Patient Consent'\n\t\t\t\t\t\t\t\t  and contains($allowedCodes, concat('|', normalize-space(OBX.3/OBX.3.1), '|'))\n\t\t\t\t\t\t\t\t  and not(preceding-sibling::OBX[\n\t\t\t\t\t\t\t\t\t  normalize-space(OBX.3/OBX.3.1) = normalize-space(current()/OBX.3/OBX.3.1)\n\t\t\t\t\t\t\t\t\t  and generate-id(preceding-sibling::OBR[1]) = generate-id(current()/preceding-sibling::OBR[1])\n\t\t\t\t\t\t\t\t  ])\n\t\t\t\t\t\t\t\t]\">\n\t\t\t<xsl:variable name=\"questionCode\" select=\"normalize-space(OBX.3/OBX.3.1)\"/>\n\t\t\t<xsl:variable name=\"observationResourceId\">\n\t\t\t  <xsl:call-template name=\"generateFixedLengthResourceId\">\n\t\t\t\t<xsl:with-param name=\"prefixString\" select=\"$questionCode\"/>\n\t\t\t\t<xsl:with-param name=\"sha256ResourceId\" select=\"$observationResourceSha256Id\"/>\n\t\t\t  </xsl:call-template>\n\t\t\t</xsl:variable>\n\t\t\t{ \"reference\": \"Observation/<xsl:value-of select='$observationResourceId'/>\" }\n\t\t\t<xsl:if test=\"position() != last()\">,</xsl:if>\n\t\t  </xsl:for-each>\n\t\t]\n      },\n      \"request\": {\n        \"method\": \"POST\",\n        \"url\": \"<xsl:value-of select='$baseFhirUrl'/>/Observation/<xsl:value-of select='$grouperObservationResourceId'/>\"\n      }\n    }\n  </xsl:for-each>\n  <!-- </xsl:if> -->\n</xsl:template>\n\n<xsl:template name=\"formatDateTime\">\n      <xsl:param name=\"dateTime\"/>\n      <xsl:choose>\n          <!-- If format is YYYYMMDDHHMMSS -->\n          <xsl:when test=\"string-length($dateTime) >= 14\">\n              <xsl:value-of select=\"concat(\n                  substring($dateTime, 1, 4), '-', \n                  substring($dateTime, 5, 2), '-', \n                  substring($dateTime, 7, 2), 'T', \n                  substring($dateTime, 9, 2), ':', \n                  substring($dateTime, 11, 2), ':', \n                  substring($dateTime, 13, 2),\n                  'Z'\n              )\"/>\n          </xsl:when>\n          <!-- If format is YYYYMMDD -->\n          <xsl:when test=\"string-length($dateTime) >= 8\">\n              <xsl:value-of select=\"concat(\n                  substring($dateTime, 1, 4), '-', \n                  substring($dateTime, 5, 2), '-', \n                  substring($dateTime, 7, 2), 'T00:00:00Z'\n              )\"/>\n          </xsl:when>\n          <!-- If format is unknown, return as is -->\n          <xsl:otherwise>\n              <xsl:value-of select=\"$dateTime\"/>\n          </xsl:otherwise>\n      </xsl:choose>\n  </xsl:template>\n\n<!-- <xsl:template name=\"mapEncounterStatusFromHL7\"> -->\n  <!-- <xsl:choose> -->\n    <!-- <xsl:when test=\"//PV1/PV1.44/PV1.44.1 and //PV1/PV1.45/PV1.45.1\">finished</xsl:when> -->\n    <!-- <xsl:when test=\"//PV1/PV1.44/PV1.44.1 and not(//PV1/PV1.45/PV1.45.1)\">in-progress</xsl:when> -->\n    <!-- <xsl:when test=\"//PV2/PV2.24/PV2.24.1 and not(//PV1/PV1.44/PV1.44.1)\">planned</xsl:when> -->\n    <!-- <xsl:otherwise>unknown</xsl:otherwise> -->\n  <!-- </xsl:choose> -->\n<!-- </xsl:template> -->\n\n<xsl:template name=\"mapObservationCategoryCodes\">\n  <xsl:param name=\"questionCode\"/>\n  <xsl:choose>\n    <xsl:when test=\"$questionCode = '71802-3'\">housing-instability</xsl:when>\n    <xsl:when test=\"$questionCode = '96778-6'\">inadequate-housing</xsl:when>\n    <xsl:when test=\"$questionCode = '96779-4'\">utility-insecurity</xsl:when>\n    <xsl:when test=\"$questionCode = '88122-7' or $questionCode = '88123-5'\">food-insecurity</xsl:when>\n    <xsl:when test=\"$questionCode = '93030-5'\">transportation-insecurity</xsl:when>\n    <xsl:when test=\"$questionCode = '96780-2'\">employment-status</xsl:when>\n    <xsl:when test=\"$questionCode = '96782-8' or \n                    $questionCode = '95618-5' or \n                    $questionCode = '95617-7' or \n                    $questionCode = '95616-9' or \n                    $questionCode = '95615-1' or \n                    $questionCode = '95614-4'\">sdoh-category-unspecified</xsl:when>\n    <xsl:otherwise/>\n  </xsl:choose>\n</xsl:template>\n\n<xsl:template name=\"mapObservationStatus\">\n    <xsl:param name=\"statusCode\"/>\n    <xsl:choose>\n        <xsl:when test=\"$statusCode = 'completed'\">final</xsl:when>\n        <xsl:when test=\"$statusCode = 'final'\">final</xsl:when>\n        <xsl:when test=\"$statusCode = 'active'\">preliminary</xsl:when>\n        <xsl:when test=\"$statusCode = 'aborted'\">cancelled</xsl:when>\n        <xsl:when test=\"$statusCode = 'cancelled'\">cancelled</xsl:when>\n        <xsl:when test=\"$statusCode = 'held'\">registered</xsl:when>\n        <xsl:when test=\"$statusCode = 'suspended'\">registered</xsl:when>\n        <xsl:when test=\"$statusCode = 'nullified'\">entered-in-error</xsl:when>\n        <xsl:otherwise>unknown</xsl:otherwise>\n    </xsl:choose>\n</xsl:template>\n\n<!-- Reusable ID generator template -->\n<xsl:template name=\"generateFixedLengthResourceId\">\n  <xsl:param name=\"prefixString\"/>\n  <xsl:param name=\"sha256ResourceId\"/>\n  <xsl:variable name=\"trimmedHashId\" select=\"substring(concat($prefixString, $sha256ResourceId), 1, 64)\"/>\n  <xsl:variable name=\"resourceUId\" select=\"$trimmedHashId\"/>\n  <xsl:copy-of select=\"$resourceUId\"/>\n</xsl:template>\n\n<xsl:template name=\"mapSDOHCategoryCodeDisplay\">\n  <xsl:param name=\"questionCode\"/>\n  <xsl:param name=\"categoryCode\"/>\n  <xsl:choose>\n    <xsl:when test=\"$questionCode = '71802-3'\">Housing Instability</xsl:when>\n    <xsl:when test=\"$questionCode = '96778-6'\">Inadequate Housing</xsl:when>\n    <xsl:when test=\"$questionCode = '96779-4'\">Utility Insecurity</xsl:when>\n    <xsl:when test=\"$questionCode = '88122-7' or $questionCode = '88123-5'\">Food Insecurity</xsl:when>\n    <xsl:when test=\"$questionCode = '93030-5'\">Transportation Insecurity</xsl:when>\n    <xsl:when test=\"$questionCode = '96780-2'\">Employment Status</xsl:when>\n    <xsl:when test=\"$questionCode = '96782-8'\">Education/Training</xsl:when>\n    <xsl:when test=\"$questionCode = '95618-5' or \n                    $questionCode = '95617-7' or \n                    $questionCode = '95616-9' or \n                    $questionCode = '95615-1' or \n                    $questionCode = '95614-4'\">Interpersonal Safety</xsl:when>\n    <xsl:otherwise>\n      <xsl:value-of select=\"$categoryCode\"/>\n    </xsl:otherwise>\n  </xsl:choose>\n</xsl:template>\n\n\n<xsl:template name=\"generateNameJson\">\n    <xsl:param name=\"nameNode\"/>\n    {\n\t\t<!-- valueString from given name (concatenation of given components) -->\n\t\t<xsl:if test=\"string($nameNode/*[2]) or string($nameNode/*[3])\">\n\t\t  \"extension\": [{\n\t\t\t\"url\": \"<xsl:value-of select='$baseFhirUrl'/>/StructureDefinition/middle-name\",\n\t\t\t\"valueString\": \"<xsl:value-of select=\"normalize-space(concat($nameNode/*[2], ' ', $nameNode/*[3]))\"/>\"\n\t\t  }],\n\t\t</xsl:if>\n\n\t\t<!-- use -->\n\t\t<xsl:if test=\"string($nameNode/*[7])\">\n\t\t  \"use\": \"<xsl:choose>\n\t\t\t\t\t<xsl:when test=\"$nameNode/*[7] = 'L'\">official</xsl:when>\n\t\t\t\t\t<xsl:when test=\"$nameNode/*[7] = 'P'\">usual</xsl:when>\n\t\t\t\t\t<xsl:otherwise><xsl:value-of select=\"$nameNode/*[7]\"/></xsl:otherwise>\n\t\t\t\t  </xsl:choose>\",\n\t\t</xsl:if>\n\n\t\t<!-- prefix -->\n\t\t<xsl:if test=\"string($nameNode/*[5])\">\n\t\t  \"prefix\": [\"<xsl:value-of select='$nameNode/*[5]'/>\"],\n\t\t</xsl:if>\n\n\t\t<!-- given -->\n\t\t<xsl:if test=\"string($nameNode/*[2]) or string($nameNode/*[3])\">\n\t\t  \"given\": [\"<xsl:value-of select='normalize-space(concat($nameNode/*[2], &quot; &quot;, $nameNode/*[3]))'/>\"]\n\t\t</xsl:if>\n\n\t\t<!-- family -->\n\t\t<xsl:if test=\"string($nameNode/*[1])\">\n\t\t  ,\"family\": \"<xsl:value-of select='$nameNode/*[1]'/>\"\n\t\t</xsl:if>\n\n\t\t<!-- suffix -->\n\t\t<xsl:if test=\"string($nameNode/*[4])\">\n\t\t  ,\"suffix\": [\"<xsl:value-of select='$nameNode/*[4]'/>\"]\n\t\t</xsl:if>\n    }\n</xsl:template>\n\n<xsl:template name=\"getNullFlavorDisplay\">\n    <xsl:param name=\"nullFlavor\"/>\n    <xsl:choose>\n        <xsl:when test=\"$nullFlavor = 'NI'\">unknown</xsl:when>\n        <xsl:when test=\"$nullFlavor = 'UNK'\">unknown</xsl:when>\n        <xsl:when test=\"$nullFlavor = 'ASKU'\">asked-unknown</xsl:when>\n        <xsl:when test=\"$nullFlavor = 'NASK'\">not-asked</xsl:when>\n        <xsl:when test=\"$nullFlavor = 'NAV'\">temp-unknown</xsl:when>\n        <xsl:when test=\"$nullFlavor = 'OTH'\">unsupported</xsl:when>\n        <xsl:when test=\"$nullFlavor = 'MSK'\">masked</xsl:when>\n        <xsl:when test=\"$nullFlavor = 'NA'\">not-applicable</xsl:when>\n        <xsl:otherwise>unknown</xsl:otherwise>\n    </xsl:choose>\n</xsl:template>\n\n<xsl:template name=\"getRaceEthnicityNullFlavorDisplay\">\n  <xsl:param name=\"nullFlavor\"/>\n  <xsl:choose>\n      <xsl:when test=\"$nullFlavor = 'UNK'\">unknown</xsl:when>\n      <xsl:when test=\"$nullFlavor = 'ASKU'\">asked but unknown</xsl:when>\n      <xsl:when test=\"$nullFlavor = 'OTH'\">other</xsl:when>\n      <xsl:otherwise>unknown</xsl:otherwise>\n  </xsl:choose>\n</xsl:template>\n\n<xsl:template name=\"mapAdministrativeGenderCode\">\n  <xsl:param name=\"genderCode\"/>\n  <xsl:choose>\n    <xsl:when test=\"$genderCode = 'M' or $genderCode = 'Male' or $genderCode = 'male'\">M</xsl:when>\n    <xsl:when test=\"$genderCode = 'F' or $genderCode = 'Female' or $genderCode = 'female'\">F</xsl:when>\n    <xsl:otherwise>UNK</xsl:otherwise>\n  </xsl:choose>\n</xsl:template>\n\n<xsl:template name=\"mapMaritalStatus\">\n    <xsl:param name=\"statusCode\"/>\n    <xsl:choose>\n        <xsl:when test=\"$statusCode = 'M'\">married</xsl:when>\n        <xsl:when test=\"$statusCode = 'S'\">Never Married</xsl:when>\n        <xsl:when test=\"$statusCode = 'A'\">Annulled</xsl:when>\n        <xsl:when test=\"$statusCode = 'D'\">Divorced</xsl:when>\n        <xsl:when test=\"$statusCode = 'I'\">Interlocutory</xsl:when>\n        <xsl:when test=\"$statusCode = 'L'\">Legally Separated</xsl:when>\n        <xsl:when test=\"$statusCode = 'C'\">Common Law</xsl:when>\n        <xsl:when test=\"$statusCode = 'P'\">Polygamous</xsl:when>\n        <xsl:when test=\"$statusCode = 'T'\">Domestic partner</xsl:when>\n        <xsl:when test=\"$statusCode = 'U'\">unmarried</xsl:when>\n        <xsl:when test=\"$statusCode = 'W'\">Widowed</xsl:when>\n        <xsl:otherwise>unknown</xsl:otherwise>\n    </xsl:choose>\n</xsl:template>\n\n<xsl:template name=\"mapMaritalStatusCode\">\n    <xsl:param name=\"statusCode\"/>\n    <xsl:choose>\n  <xsl:when test='$statusCode = \"M\" or\n                  $statusCode = \"S\" or\n                  $statusCode = \"A\" or\n                  $statusCode = \"D\" or\n                  $statusCode = \"I\" or\n                  $statusCode = \"L\" or\n                  $statusCode = \"C\" or\n                  $statusCode = \"P\" or\n                  $statusCode = \"T\" or\n                  $statusCode = \"U\" or\n                  $statusCode = \"W\"'>\n    <xsl:value-of select='$statusCode'/>\n  </xsl:when>\n  <xsl:otherwise/>\n</xsl:choose>\n</xsl:template>\n\n<xsl:template name=\"getDataAbsentReasonFhirCode\">\n  <xsl:param name=\"dataAbsentReason\"/>\n  <xsl:choose>\n    <xsl:when test=\"$dataAbsentReason = 'X-SDOH-FLO-1570000066-Patient unable to answer'\">asked-unknown</xsl:when>\n    <xsl:when test=\"$dataAbsentReason = 'X-SDOH-FLO-1570000066-Patient declined'\">asked-declined</xsl:when>\n    <xsl:otherwise/>\n  </xsl:choose>\n</xsl:template>\n\n<xsl:template name=\"getDataAbsentReasonFhirDisplay\">\n  <xsl:param name=\"dataAbsentReasonCode\"/>\n  <xsl:choose>\n    <xsl:when test=\"$dataAbsentReasonCode = 'asked-unknown'\">Asked But Unknown</xsl:when>\n    <xsl:when test=\"$dataAbsentReasonCode = 'asked-declined'\">Asked But Declined</xsl:when>\n    <xsl:otherwise/>\n  </xsl:choose>\n</xsl:template>\n\n</xsl:stylesheet>",
    "hl7v2-validation-schema" : "<ConformanceProfile ID=\"ORU_R01_Profile_v23\" Name=\"ORU^R01\" HL7Version=\"2.3\">\n  <MessageStructure ID=\"ORU_R01\">\n    <SegmentGroup Name=\"ORU_R01_Message\">\n      <Segment Name=\"MSH\" Usage=\"R\" MinOccurs=\"1\" MaxOccurs=\"1\"/>\n      <Segment Name=\"PID\" Usage=\"R\" MinOccurs=\"1\" MaxOccurs=\"1\"/>\n\t  <Segment Name=\"PV1\" Usage=\"R\" MinOccurs=\"1\" MaxOccurs=\"1\"/>\n    </SegmentGroup>\n  </MessageStructure>\n  <Segments>\n    <SegmentDef Name=\"MSH\">\n      <Field Name=\"MSH-6\" Datatype=\"HD\" Usage=\"O\"/>\n    </SegmentDef>\n    <SegmentDef Name=\"PID\">\n\t  <Field Name=\"PID-3.1\" Datatype=\"CX\" Usage=\"R\" Description=\"MR value\"/>\n      <Field Name=\"PID-7\" Datatype=\"CX\" Usage=\"R\" Description=\"birth date\"/>\n      <Field Name=\"PID-8\" Datatype=\"XPN\" Usage=\"R\" Description=\"gender\"/>\n\t  \n    <OneOfGroup Description=\"Patient Name or Alias (Family)\">\n        <Field Name=\"PID-5.1\" Datatype=\"XPN\" Usage=\"C\" Description=\"Patient Name Family\"/>\n        <Field Name=\"PID-9.1\" Datatype=\"XPN\" Usage=\"C\" Description=\"Patient Alias Family\"/>\n    </OneOfGroup>\n\n    <OneOfGroup Description=\"Patient Name or Alias (Given)\">\n        <Field Name=\"PID-5.2\" Datatype=\"XPN\" Usage=\"C\" Description=\"Patient Name Given\"/>\n        <Field Name=\"PID-9.2\" Datatype=\"XPN\" Usage=\"C\" Description=\"Patient Alias Given\"/>\n    </OneOfGroup>\n\t  \n    </SegmentDef>\n\n    <SegmentDef Name=\"OBX\">\n      <Field Name=\"OBX-2\" Datatype=\"ID\" Usage=\"R\"/>\n      <Field Name=\"OBX-3\" Datatype=\"CE\" Usage=\"R\"/>\n\t  <Field Name=\"OBX-3.1\" Datatype=\"CE\" Usage=\"R\" Description=\"Question code\"/>\n    </SegmentDef>\n\t<SegmentDef Name=\"PV1\">\n      <Field Name=\"PV1-2\" Datatype=\"TS\" Usage=\"R\"/>\n\t  <Field Name=\"PV1-2.1\" Datatype=\"TS\" Usage=\"R\" Description=\"Encounter class -> code\"/>\n    </SegmentDef>\n  </Segments>\n</ConformanceProfile>"
  },
  "exportDate" : "2025-11-20T06:11:23.083+00:00"
}